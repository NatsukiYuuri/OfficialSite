/*! typescript-cookie v1.0.6 | MIT */const E=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),w=n=>encodeURIComponent(n).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent),g=decodeURIComponent,h=n=>(n[0]==='"'&&(n=n.slice(1,-1)),n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent));function C(n){return n=Object.assign({},n),typeof n.expires=="number"&&(n.expires=new Date(Date.now()+n.expires*864e5)),n.expires!=null&&(n.expires=n.expires.toUTCString()),Object.entries(n).filter(([e,t])=>t!=null&&t!==!1).map(([e,t])=>t===!0?`; ${e}`:`; ${e}=${t.split(";")[0]}`).join("")}function M(n,e,t){const i=/(?:^|; )([^=]*)=([^;]*)/g,s={};let a;for(;(a=i.exec(document.cookie))!=null;)try{const r=t(a[1]);if(s[r]=e(a[2],r),n===r)break}catch{}return n!=null?s[n]:s}const D=Object.freeze({decodeName:g,decodeValue:h,encodeName:E,encodeValue:w}),f=Object.freeze({path:"/"});function u(n,e,t=f,{encodeValue:i=w,encodeName:s=E}={}){return document.cookie=`${s(n)}=${i(e,n)}${C(t)}`}function S(n,{decodeValue:e=h,decodeName:t=g}={}){return M(n,e,t)}function A({decodeValue:n=h,decodeName:e=g}={}){return M(void 0,n,e)}function T(n,e=f){u(n,"",Object.assign({},e,{expires:-1}))}function m(n,e){const t={set:function(s,a,r){return u(s,a,Object.assign({},this.attributes,r),{encodeValue:this.converter.write})},get:function(s){if(arguments.length===0)return A(this.converter.read);if(s!=null)return S(s,this.converter.read)},remove:function(s,a){T(s,Object.assign({},this.attributes,a))},withAttributes:function(s){return m(this.converter,Object.assign({},this.attributes,s))},withConverter:function(s){return m(Object.assign({},this.converter,s),this.attributes)}},i={attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(n)}};return Object.create(t,i)}m({read:D.decodeValue,write:D.encodeValue},f);class v{constructor(){this.STAMP_RES_PATH="../assets/res/others/202508event/inkan.png",this.GRACE_TIME=40,this.YEAR=2025,this.Month=7,this.RestDays=[11,14,15],this.Init()}async Init(){const e=await this.PopSetTimeWindowAsync();console.log(e);const t=document.getElementById("calendar-days");if(t){const i=new Date,s={},a=new Date(this.YEAR,this.Month,1).getDay();for(let o=0;o<a;o++){const c=document.createElement("div");c.classList.add("_day","_empty"),t.append(c)}let r=0;const d=new Date(this.YEAR,this.Month+1,0).getDate();for(let o=0;o<d;o++){const c=document.createElement("div");c.classList.add("_day"),t.append(c),c.textContent=(o+1).toString(),this.isActiveDay(o)?r++:c.classList.add("_empty"),s[o+1]=c}const p=new Date(this.YEAR,this.Month+1,0).getDay();for(let o=0;o<7-p-1;o++){const c=document.createElement("div");c.classList.add("_day","_empty"),t.append(c)}const l=this.GetDaysCookie();for(let o=0;o<l.length;o++){const c=l[o],y=document.createElement("img");y.src=this.STAMP_RES_PATH,s[c].append(y)}if(this.isActiveDay(i.getDate())&&this.isWithinMinutes(e,this.GRACE_TIME)){const o=i.getDate();l.includes(o)||l.push(o),this.SetDaysCookie(l);const c=document.createElement("img");c.src=this.STAMP_RES_PATH,s[o].append(c)}this.SettingUserDatasText(e,r,l.length)}}SettingUserDatasText(e,t,i){const s=document.getElementById("login-stamp-card-setting-time-text");s.textContent=e;const a=document.getElementById("login-stamp-card-progress-text");a.textContent=i.toString()+"/"+t.toString()}async PopSetTimeWindowAsync(){const e="referenceTime";return new Promise((t,i)=>{const s=this.MyGetData(e);s==null||s==""?(console.log("targetが見つかりません"),document.getElementById("set-time-window-button").addEventListener("click",r=>{const d=document.getElementById("set-time-window-time");if(/^([01]\d|2[0-3]):[0-5]\d$/.test(d.value)){this.MySetData(e,d.value),document.getElementById("set-time-window").style.display="none",t(d.value);return}console.log("時間が有効ではありません")})):(document.getElementById("set-time-window").style.display="none",t(s))})}SetDaysCookie(e){this.MySetData("days",JSON.stringify(e))}GetDaysCookie(){const e=this.MyGetData("days");return e==null?[]:JSON.parse(e)}MySetData(e,t){u(e,t,{expires:100,path:"/",secure:!0,sameSite:"Lax"}),localStorage.setItem(e,t)}MyGetData(e){let t=S(e);return(t==null||t=="")&&(t=localStorage.getItem(e),t==null&&(t=void 0)),t}MyClearData(e){u(e,"",{expires:100,path:"/",secure:!0,sameSite:"Lax"}),localStorage.removeItem(e)}isWithinMinutes(e,t){const i=new Date;if(console.log("現在："+i.getMonth()+" 設定："+this.Month),i.getMonth()!=this.Month)return!1;const[s,a]=e.split(":").map(Number),r=new Date(i.getFullYear(),i.getMonth(),i.getDate(),s,a);return Math.abs(r.getTime()-i.getTime())<=t*60*1e3}isActiveDay(e){const t=new Date(this.YEAR,this.Month,e+1).getDay();return console.log(t),t==6||t==0?!1:!this.RestDays.includes(e+1)}}new v;
