/*! typescript-cookie v1.0.6 | MIT */const D=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),E=n=>encodeURIComponent(n).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent),g=decodeURIComponent,y=n=>(n[0]==='"'&&(n=n.slice(1,-1)),n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent));function T(n){return n=Object.assign({},n),typeof n.expires=="number"&&(n.expires=new Date(Date.now()+n.expires*864e5)),n.expires!=null&&(n.expires=n.expires.toUTCString()),Object.entries(n).filter(([e,t])=>t!=null&&t!==!1).map(([e,t])=>t===!0?`; ${e}`:`; ${e}=${t.split(";")[0]}`).join("")}function S(n,e,t){const s=/(?:^|; )([^=]*)=([^;]*)/g,i={};let r;for(;(r=s.exec(document.cookie))!=null;)try{const o=t(r[1]);if(i[o]=e(r[2],o),n===o)break}catch{}return n!=null?i[n]:i}const p=Object.freeze({decodeName:g,decodeValue:y,encodeName:D,encodeValue:E}),f=Object.freeze({path:"/"});function u(n,e,t=f,{encodeValue:s=E,encodeName:i=D}={}){return document.cookie=`${i(n)}=${s(e,n)}${T(t)}`}function A(n,{decodeValue:e=y,decodeName:t=g}={}){return S(n,e,t)}function C({decodeValue:n=y,decodeName:e=g}={}){return S(void 0,n,e)}function M(n,e=f){u(n,"",Object.assign({},e,{expires:-1}))}function h(n,e){const t={set:function(i,r,o){return u(i,r,Object.assign({},this.attributes,o),{encodeValue:this.converter.write})},get:function(i){if(arguments.length===0)return C(this.converter.read);if(i!=null)return A(i,this.converter.read)},remove:function(i,r){M(i,Object.assign({},this.attributes,r))},withAttributes:function(i){return h(this.converter,Object.assign({},this.attributes,i))},withConverter:function(i){return h(Object.assign({},this.converter,i),this.attributes)}},s={attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(n)}};return Object.create(t,s)}h({read:p.decodeValue,write:p.encodeValue},f);class v{constructor(){this.STAMP_RES_PATH="../assets/res/others/202508event/inkan.png",this.GRACE_TIME=40,this.YEAR=2025,this.Month=7,this.RestDays=[11,14,15],this.DATA_KEYS={Name:"key",ReferenceTime:"referenceTime",Days:"days"},this.Init()}async Init(){const e=await this.PopSetTimeWindowAsync();console.log(e),document.querySelector("#time-reset-button").addEventListener("click",s=>{this.MyClearData(this.DATA_KEYS.ReferenceTime),window.location.reload()}),document.querySelector("#add-first-time").addEventListener("click",s=>{const i=this.GetDaysCookie();i.includes(1)||(i.push(1),this.SetDaysCookie(i)),document.getElementById("thx-window").style.display="block"}),document.querySelector("#thx-window-close").addEventListener("click",s=>{window.location.reload()});const t=document.getElementById("calendar-days");if(t){const s=new Date,i={},r=new Date(this.YEAR,this.Month,1).getDay();for(let a=0;a<r;a++){const c=document.createElement("div");c.classList.add("_day","_empty"),t.append(c)}let o=0;const m=new Date(this.YEAR,this.Month+1,0).getDate();for(let a=0;a<m;a++){const c=document.createElement("div");c.classList.add("_day"),t.append(c),c.textContent=(a+1).toString(),this.isActiveDay(a+1)?o++:c.classList.add("_empty"),i[a+1]=c}const w=new Date(this.YEAR,this.Month+1,0).getDay();for(let a=0;a<7-w-1;a++){const c=document.createElement("div");c.classList.add("_day","_empty"),t.append(c)}const d=this.GetDaysCookie();for(let a=0;a<d.length;a++){const c=d[a],l=document.createElement("img");l.src=this.STAMP_RES_PATH,i[c].append(l)}document.querySelector("#login-stamp-button").addEventListener("click",a=>{if(this.isActiveDay(s.getDate())&&this.isWithinMinutes(e,this.GRACE_TIME)){const c=s.getDate();d.includes(c)||d.push(c),this.SetDaysCookie(d);const l=document.createElement("img");l.src=this.STAMP_RES_PATH,i[c].append(l)}}),this.SettingUserDatasText(e,o,d.length)}}SettingUserDatasText(e,t,s){const i=document.getElementById("login-stamp-card-setting-time-text");i.textContent=e;const r=document.getElementById("login-stamp-card-progress-text");r.textContent=s.toString()+"/"+t.toString();const o=document.getElementById("login-stamp-card-test-text");o.textContent=localStorage.getItem(this.DATA_KEYS.Days)}async PopSetTimeWindowAsync(){return new Promise((e,t)=>{const s=this.MyGetData(this.DATA_KEYS.ReferenceTime);s==null||s==""?(console.log("targetが見つかりません"),document.getElementById("set-time-window-button").addEventListener("click",r=>{const o=document.getElementById("set-time-window-time");if(/^([01]\d|2[0-3]):[0-5]\d$/.test(o.value)){this.MySetData(this.DATA_KEYS.ReferenceTime,o.value),document.getElementById("set-time-window").style.display="none",e(o.value);return}console.log("時間が有効ではありません")})):(document.getElementById("set-time-window").style.display="none",e(s))})}PushTodayStamp(e,t,s,i){}SetDaysCookie(e){this.MySetData(this.DATA_KEYS.Days,JSON.stringify(e))}GetDaysCookie(){const e=this.MyGetData(this.DATA_KEYS.Days);return e==null?[]:JSON.parse(e)}MySetData(e,t){u(e,t,{expires:100,path:"/",secure:!0}),localStorage.setItem(e,t)}MyGetData(e){let t=A(e);return(t==null||t=="")&&(t=localStorage.getItem(e),t==null&&(t=void 0)),t}MyClearData(e){u(e,"",{expires:100,path:"/",secure:!0,sameSite:"Lax"}),localStorage.removeItem(e)}isWithinMinutes(e,t){const s=new Date;if(console.log("現在："+s.getMonth()+" 設定："+this.Month),s.getMonth()!=this.Month)return!1;const[i,r]=e.split(":").map(Number),o=new Date(s.getFullYear(),s.getMonth(),s.getDate(),i,r);return Math.abs(o.getTime()-s.getTime())<=t*60*1e3}isActiveDay(e){const t=new Date(this.YEAR,this.Month,e).getDay();return t==6||t==0?!1:!this.RestDays.includes(e)}}new v;
