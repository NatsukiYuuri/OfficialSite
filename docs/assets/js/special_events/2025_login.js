/*! typescript-cookie v1.0.6 | MIT */const w=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),C=e=>encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent),f=decodeURIComponent,p=e=>(e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent));function T(e){return e=Object.assign({},e),typeof e.expires=="number"&&(e.expires=new Date(Date.now()+e.expires*864e5)),e.expires!=null&&(e.expires=e.expires.toUTCString()),Object.entries(e).filter(([t,n])=>n!=null&&n!==!1).map(([t,n])=>n===!0?`; ${t}`:`; ${t}=${n.split(";")[0]}`).join("")}function A(e,t,n){const o=/(?:^|; )([^=]*)=([^;]*)/g,s={};let c;for(;(c=o.exec(document.cookie))!=null;)try{const a=n(c[1]);if(s[a]=t(c[2],a),e===a)break}catch{}return e!=null?s[e]:s}const E=Object.freeze({decodeName:f,decodeValue:p,encodeName:w,encodeValue:C}),y=Object.freeze({path:"/"});function u(e,t,n=y,{encodeValue:o=C,encodeName:s=w}={}){return document.cookie=`${s(e)}=${o(t,e)}${T(n)}`}function g(e,{decodeValue:t=p,decodeName:n=f}={}){return A(e,t,n)}function M({decodeValue:e=p,decodeName:t=f}={}){return A(void 0,e,t)}function S(e,t=y){u(e,"",Object.assign({},t,{expires:-1}))}function h(e,t){const n={set:function(s,c,a){return u(s,c,Object.assign({},this.attributes,a),{encodeValue:this.converter.write})},get:function(s){if(arguments.length===0)return M(this.converter.read);if(s!=null)return g(s,this.converter.read)},remove:function(s,c){S(s,Object.assign({},this.attributes,c))},withAttributes:function(s){return h(this.converter,Object.assign({},this.attributes,s))},withConverter:function(s){return h(Object.assign({},this.converter,s),this.attributes)}},o={attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(e)}};return Object.create(n,o)}h({read:E.decodeValue,write:E.encodeValue},y);class b{constructor(){this.STAMP_RES_PATH="../assets/res/others/202508event/inkan.png",this.GRACE_TIME=40,this.YEAR=2025,this.Month=7,this.RestDays=[11,14,15],this.Init()}async Init(){const t=await this.PopSetTimeWindowAsync();console.log(t);const n=document.getElementById("calendar-days");if(n){const o=new Date,s={},c=new Date(this.YEAR,this.Month,1).getDay();for(let i=0;i<c;i++){const r=document.createElement("div");r.classList.add("_day","_empty"),n.append(r)}let a=0;const m=new Date(this.YEAR,this.Month+1,0).getDate();for(let i=0;i<m;i++){const r=document.createElement("div");r.classList.add("_day"),n.append(r),r.textContent=(i+1).toString(),this.isActiveDay(i)?r.classList.add("_empty"):a++,s[i+1]=r}const l=new Date(this.YEAR,this.Month+1,0).getDay();for(let i=0;i<7-l-1;i++){const r=document.createElement("div");r.classList.add("_day","_empty"),n.append(r)}const d=this.GetDaysCookie();for(let i=0;i<d.length;i++){const r=d[i],D=document.createElement("img");D.src=this.STAMP_RES_PATH,s[r].append(D)}if(this.isActiveDay(o.getDay())&&this.isWithinMinutes(t,this.GRACE_TIME)){const i=o.getDate();d.includes(i)||d.push(i),this.SetDaysCookie(d);const r=document.createElement("img");r.src=this.STAMP_RES_PATH,s[i].append(r)}this.SettingUserDatasText(t,a,d.length)}}SettingUserDatasText(t,n,o){const s=document.getElementById("login-stamp-card-setting-time-text");s.textContent=t;const c=document.getElementById("login-stamp-card-progress-text");c.textContent=o.toString()+"/"+n.toString()}async PopSetTimeWindowAsync(){const t="referenceTime",n=new Date;return new Promise((o,s)=>{const c=g(t);c==null?(console.log("targetが見つかりません"),document.getElementById("set-time-window-button").addEventListener("click",m=>{const l=document.getElementById("set-time-window-time");if(/^([01]\d|2[0-3]):[0-5]\d$/.test(l.value)){u(t,l.value,{expires:n.setMonth(n.getMonth()+2)}),document.getElementById("set-time-window").style.display="none",o(l.value);return}console.log("時間が有効ではありません")})):(document.getElementById("set-time-window").style.display="none",o(c))})}SetDaysCookie(t){const n=new Date;u("days",JSON.stringify(t),{expires:n.setMonth(n.getMonth()+2)})}GetDaysCookie(){const t=g("days");return t==null?[]:JSON.parse(t)}isWithinMinutes(t,n){const o=new Date;if(o.getMonth()!=this.Month)return!1;const[s,c]=t.split(":").map(Number),a=new Date(o.getFullYear(),o.getMonth(),o.getDate(),s,c);return Math.abs(a.getTime()-o.getTime())<=n*60*1e3}isActiveDay(t){const n=new Date(this.YEAR,this.Month,t+1).getDay();return n==6||n==0?!0:!!this.RestDays.includes(t+1)}}new b;
